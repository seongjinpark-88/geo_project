package timenorm

import java.io.File

import jline.console.ConsoleReader
import jline.console.history.FileHistory
import org.clulab.odin.{Mention, ExtractorEngine} // Attachment
import org.clulab.processors.{Document, Processor}
import org.clulab.processors.fastnlp.FastNLPProcessor
import utils._

import org.clulab.timenorm.scate._

import scala.collection.immutable.{HashMap, ListMap}
import scala.collection.mutable
import scala.collection.mutable.ListBuffer

// case class AbsTime(year: Int) extends Attachment

object TimenormExample extends App {

	// create the normalizer
  	val parser = new TemporalNeuralParser

  	val proc:Processor = new FastNLPProcessor(withDiscourse = false)

  	// set today's time
  	val anchor = SimpleInterval.of(2019, 11, 18)

	val text = "Clay mineral assemblages at IODP Site U1340 in the Bering Sea and their paleoclimatic significance. Abstract: Clay mineral assemblages and crystallinities in sediments from IODP Site 1340 in the Bering Sea were analyzed in order to trace sediment sources and reconstruct the paleoclimatic history of the Bering Sea since Pliocene (the last ~4.3 Ma). The results show that clay minerals at Site U1340 are dominated by illite, with a moderate amount of smectite and chlorite, and minor kaolinite. Sediment source studies suggest that the clay mineral assemblages and their sources in the studied core are controlled primarily by the climate conditions. During the warm periods, clay minerals originated mainly from the adjacent Aleutian Islands, and smectite/(illite+chlorite) ratios increased. During the cold periods, clay minerals from the Alaskan region distinctly increased, and smectite/(illite+chlorite) ratios declined. Based on smectite/(illite+chlorite) ratios and clay mineral crystallinities, the evolutionary history of the paleoclimate was revealed in the Bering Sea. In general, the Bering Sea was characterized by warm and wet climate condition from 4.3 to 3.94 Ma, and then cold and dry condition associated with the enhanced volcanism from 3.94 to 3.6 Ma. Thereafter, the climate gradually became cold and wet, and then was dominated by a cold and dry condition since 2.74 Ma, probably induced by the intensification of the Northern Hemisphere Glaciation. The interval from 1.95 to 1.07 Ma was a transitional period of the climate gradually becoming cold and wet. After the middle Pleistocene transition (1.07 to 0.8 Ma), the Bering Sea was governed mainly by cold and wet climate with several intervals of warm climate at ~0.42 Ma (MIS 11), ~0.33 Ma (MIS 9) and ~0.12 Ma (MIS 5), respectively. During the last 9.21 ka (the Holocene), the Bering Sea was characterized primarily by relatively warm and wet climatic conditions. 5 Conclusions: The age model of IODP Site U1340 is amended, and the base age is calculated as about 4.3 Ma, that is, the late Early Pliocene (Late Zanclean).Clay mineral assemblages at Site U1340 consist mainly of illite (an average of 70%), followed by smectite and chlorite (an average of 17% and 10%, respectively), with minor kaolinite (an average of 3%). The sources of clay minerals are closely related to the climate conditions. During the warm periods, the clay minerals originated mainly from the adjacent Aleutian Islands, and smectite/(illite+ chlorite) ratios increased. During the cold periods, clay minerals from the Alaskan region distinctly increased, and smectite/(illite+chlorite) ratios declined. Thus, the smectite/(illite+chlorite) ratio may be used as a proxy on climatechanges in the Bering Sea and adjacent regions. The evolutionary history of the paleoclimate was revealed in the Bering Sea based on smectite/(illite+chlorite) ratios and clay mineral crystallinities. In general, the Bering Sea was characterized by warm and wet climate condition from 4.3 to 3.94 Ma, and then cold and dry condition associated with the enhancing of the volcanism from 3.94 to 3.6 Ma. Thereafter, the climate gradually became cold and wet, and then was dominated by the cold and dry climate since 2.74 Ma, probably induced by the intensification of the Northern Hemisphere Glaciation. The interval from 1.95 to 1.07 Ma was a transitional period of the climate gradually becoming cold and wet. After the middle Pleistocene transition (1.07 to 0.8 Ma), the Bering Sea was governed mainly by cold and wet climate with several intervals of warm climate and intensified chemical weathering at ~0.42 Ma (MIS 11), ~0.33 Ma (MIS 9), and ~0.12 Ma (MIS 5), respectively. During the last 9.21 ka (the Holocene), the Bering Sea was characterized primarily by relatively warm and wet climatic conditions.Samples used in this research were provided by the Integrated Ocean Drilling Program (IODP). This work was supported by National Natural Science Foundation of China (Grant Nos. 41476037, 41076026, 41276051 and 91228207), the National Key Basic Research Program of China (Grant No. 2013CB956102), and IODP-China.Aiello I W, Ravelo A C. 2012. Evolution of marine sedimentation in the Bering Sea since the Pliocene. Geosphere, 8: 12311253 Bintanja R, van de Wal R S, Oerlemans J. 2005. Modelled atmospheric temperatures and global sea levels over the past million years. Nature, 437: 125128 Biscaye P E. 1965. Mineralogy and sedimentation of recent deep-sea clay in the Atlantic Ocean and adjacent seas and oceans. Geol Soc Am Bull, 76: 803832 Chamley H, Diester-Haass L. 1979. Upper Miocene to Pleistocene climates in northwest Africa deduced from terrigenous components of Site 397 sediments (DSDP Leg 47A). In: Ryan W B F, Sibuet J C, et al., eds. Init Repts DSDP. Washington D C: U.S. Government Printing Office. 641646 Chamley H. 1989. Clay Sedimentology. New York: Springer-Verlag, 1561 Chekhovich V D, Kovalenko D V, Ledneva G V. 1999. Cenozoic history of the Bering Sea and its northwestern margin. Isl Arc, 8: 168180 Chen M H, Zhang Q, Zhang L L, et al. 2014. Stratigraphic distribution of the radiolaria Spongodiscus biconcavus Haeckel at IODP Site U1340 in the Bering Sea and its paleoceanographic significance. Paleoworld, 23: 90104 Clark P U, Archer D, Pollard D, et al. 2006. The middle Pleistocene transition: Characteristics, mechanisms, and implications for long-term changes in atmospheric PCO2. Quat Sci Rev, 25:31503184 Coachman L K, Whitledge T E, Goering J J. 1999. Silica in Bering Sea deep and bottom water. In: Loughlin T R, Ohtani K, eds. The Physical Oceanography of the Bering Sea. Fairbanks: University of Alaska Sea Grant. 285309 Diekmann B, Petschick R, Gingele F X, et al. 1996. Clay mineral fluctuations in late Quaternary of the southeastern South Atlantic: Implications for past changes of deepwater advection. In: Wefer G, Berger W H, Siedler G, et al., eds. The South Atlantic: Present and Past Circulation. Berlin: Springer. 621644 Ehrmann W. 1998. Implications of late Eocene to early Miocene clay mineral assemblages in McMurdo Sound (Ross Sea, Antarctica) on paleo-climate and ice dynamics. Paleogeogr Paleoclimatol Paleoecol, 139: 213231 Ehrmann W, Setti M, Marinoni L. 2005. Clay minerals in Cenozoic sediments off Cape Roberts (McMurdo Sound, Antarctica) reveal palaeoclimatic history. Paleogeogr Paleoclimatol Paleoecol, 229: 187211 EPCIA community. 2004. Eight glacial cycles from an Antarctic ice core. Nature, 429: 623628 Franke D, Ehrmann W. 2010. Neogene clay mineral assemblages in the AND-2A drill core (McMurdo Sound, Antarctica) and their implications for environmental change. Paleogeogr Paleoclimatol Paleoecol, 286: 5565 Gardner J V, Dean W E, Vallier T L. 1980. Sedimentology and geochemistry of surface sediments, outer continental shelf, southern Bering Sea. Mar Geol, 35: 299329 Gingele F X. 1996. Holocene climatic optimum in Southwest AfricaEvidence from the marine clay mineral record. Paleogeogr Paleoclimatol Paleoecol, 122: 7787 Gingele F X, Muller P M, Schneider R R. 1998. Orbital forcing of freshwater input in the Zaire Fan areaClay mineral evidence from the last 200 kyr. Paleogeogr Paleoclimatol Paleoecol, 138: 1726 Hood D W. 1983. The Bering Sea. In: Ketchum B H, ed. Estuaries and Enclosed Seas. London: Elsevier Science Publishing Co. 337373 Hopkins D M. 1973. Sea level history in Beringia during the past 250000 years. Quat Res, 3: 520540 Imbrie J, Shackleton N J, Pisias N G, et al. 1984. The orbital theory of Pleistocene climate: Support from a revised chronology of the marine 18O record. In: Berger A, ed. Milankovitch and Climate, Part 1. Dordrecht: Reidel Publishing Company. 269305 Jacobs M B, Hays J D. 1972. Paleo-climatic events indicated by mineralogical changes in deep-sea sediments. J Sediment Res, 42: 889898 Jansen J, Kuijpers A, Troelstra S. 1986. A mid-Brunhes climatic event: Long-term changes in global atmosphere and ocean circulation. Science, 232: 619622 Jeong G Y, Yoon H I, Lee S Y. 2004. Chemistry and microstructures of clay particles in smectite-rich shelf sediments, South Shetland Islands, Antarctica. Mar Geol, 209: 1930 Kent D, Opdyke N D, Ewing M. 1971. Climate change in the North Pacific using ice-rafted detritus as a climatic indicator. Geo Soc Am Bull, 82: 27412754 Knebel H J, Creager J S. 1973. Yukon River: Evidence for extensive migration during the Holocene transgression. Science, 179: 12301232 Ling H Y. 1992. Late Neogene silicoflagellates and ebridians from Leg 128, Sea of Japan. In: Pisciotto K A, Ingle J C, Jr von Breymann M T, et al., eds. Proceedings of the Ocean Drilling Program. Scientific Results 127/128. College Station: Ocean Drilling Program. 237248 Lisiecki L E, Raymo M E. 2005. A Pliocene-Pleistocene stack of 57 globally distributed benthic 18O records. Paleoceanography, 20: PA1003. doi: 10.1029/2004PA001071 Liu J G, Li T G, Xiang R et al. 2013. Influence of the Kuroshio Current intrusion on Holocene environmental transformation in the South China Sea. Holocene. 23: 850859 Liu Z F, Trentesaux A, Clemens S C, et al. 2003. Clay mineral assemblages in the northern South China Sea: Implications for East Asian monsoon evolution over the past 2 million years. Mar Geol, 201: 133146 Liu Z F, Colin C, Trentesaux A, et al. 2005. Clay mineral records of East Asian monsoon evolution during late Quaternary in the southern South China Sea. Sci China Ser D-Earth Sci, 48: 8492 Liu Z F, Zhao Y L, Li J R, et al. 2007. Late Quaternary clay minerals off Middle Vietnam in the western South China Sea: Implications for source analysis and East Asian monsoon evolution. Sci China Ser D-Earth Sci, 50: 16741684 Liu Z F, Wang H, Hantoro W S, 2012. Climatic and tectonic controls on chemical weathering in tropical Southeast Asia (Malay Peninsula, Borneo, and Sumatra). Chem Geol, 291: 112 Marz C, Schnetger B, Brumsack H J. 2013. Nutrient leakage from the North Pacific to the Bering Sea (IODP Site U1341) following the onset of Northern Hemispheric Glaciation? Paleoceanography, 28: 6878 Maslin M A, Haug G H, Sarnthein M, et al. 1996. The progressive intensification of Northern Hemisphere glaciation as seen from the North Pa-cific. Geol Rundsch, 85: 452465 McManus D A, Venkatarathnam K, Hopkins D M, et al. 1974. YukonRiver sediment on the northernmost Bering Sea shelf. J Sediment Res, 44: 10521060 Moore D M, Reynolds R C J. 1997. X-ray Diffraction and the Identification and Analysis of Clay Minerals. Oxford: Oxford University Press. 332 Mowatt T C, Naidu A S. 1987. A brief overview of the clay mineral assemblages in sediments of the major rivers of Alaska and adjacent Arctic Canada. In: Degens E T, Kempe S, Weibin G, eds. Transport of Carbon and Minerals in Major World Rivers. Hamburg: University of Hamburg. 269277 Mudelsee M, Schulz M. 1997. The Mid-Pleistocene climate transition: Onset of 100 ka cycle lags ice volume build-up by 280 ka. Earth Planet Sci Lett, 151: 117123 Naidu A S, Creager J S, Mowatt T C. 1982. Clay mineral dispersal patterns in the North Bering and Chukchi Seas. Mar Geol, 47: 115 Naidu A S, Mowatt T C. 1983. Sources and dispersal patterns of clay minerals in surface sediments from the continental-shelf areas off Alaska. Geol Soc Am Bull, 94: 841854 Naidu A S, Han M W, Mowatt T C, et al. 1995. Clay minerals as indicators of sources of terrigenous sediments, their transportation and deposition: Bering Basin, Russian-Alaskan Arctic. Mar Geol, 127: 87104 Onodera J, Takahashi K, Nagatomo R. 2013. Diatoms, silicoflagellates, and ebridians at Site U1341 on the western slope of Bowers Ridge, IODP Expedition 323. Deep-Sea Res Part II-Top Stud Oceanogr, doi: 10.1016/j.dsr2.2013.03.025 Pearson C A, Mojfeld H O, Tripp R B. 1981. Tides of the eastern Bering Sea shelf. In: Hood D W, Calder J A, eds. The Eastern Bering Sea Shelf: Oceanography and Resources. Washington D C: U S Gov Print Off. 111130 Petschick R, Kuhn G, Gingele F. 1996. Clay mineral distribution in surface sediments of the South Atlantic: Sources, transport, and relation to oceanography. Mar Geol, 130: 203229 Ping C L, Shoji S, Ito T. 1988. Properties and classification of three volcanic ash-derived pedons from Aleutian Islands and Alaska Peninsula, Alaska. Soil Sci Soc Am J, 52: 455462 Pisias N G, Moore Jr T C. 1981. The evolution of Pleistocene climate: A time series approach. Earth Planet Sci Lett, 52: 450458 Raymo M E. 1994. The initiation of Northern Hemisphere glaciation. Annu Rev Earth Planet Sci, 22: 353383 Roden G I. 1967. On river discharge into the northeastern Pacific Ocean and the Bering Sea. J Geophys Res, 72: 56135629 Rohling E J, Fenton M, Jorissen F J, et al. 1998. Magnitudes of sea-level lowstands of the past 500000 yr. Nature, 394: 162165 Sancetta C, Robinson S. 1983. Diatom evidence on Wisconsin and Holocene events in the Bering Sea. Quat Res, 20: 232245 Sancetta C L, Hausser L, Labeyrie L, et al. 1985. Wisconsin-Holocene paleoenvironment of the Bering Sea: Evidence from diatoms, pollen, oxygen isotopes and clay mineralogy. Mar Geol, 62: 5568 Scholl D W, Buffington E C, Hopkins D M. 1968. Geologic history of the continental margin of North America in Bering Sea. Mar Geol, 6: 297330 Scholl D W, Buffington E C, Hopkins D M, et al. 1970. The structure and origin of the large submarine canyons of the Bering Sea. Mar Geol, 8: 187210 Scholl D W, Buffington E C, Marlow M S. 1975. Plate tectonics and the structural evolution of the Aleutian-Bering Sea region. In: Forbes R B, ed. Contributions to the Geology of the Bering Sea Basin and Adjacent Regions. Geol Soc Am Spec Paper, 151: 132 Singer A. 1984. The paleoclimatic interpretation of clay minerals in sedimentsA review. Earth-Sci Rev, 21: 251293 Stabeno P J, Reed R K, Overland J E, 1994. Lagrangian measurements in the Kamchatka Current and Oyashio. J Oceanogr, 50: 653662 Takahashi K. 1998. The Bering Sea and Okhotsk Sea: Modern and past paleoceanographhic changes and gateway impact. J Asian Earth Sci, 16: 4958 Takahashi K. 1999. Paleoceanographic changes and present environment of the Bering Sea. In: Loughlin T R, Ohtani K. eds. Dynamics of theBering Sea. Fairbanks: University of Alaska Sea Grant. 365385 Takahashi K. 2005. The Bering Sea and paleoceanography. Deep-Sea ResPart II-Top Stud Oceanogr, 52: 20802091 Takahashi K, Ravelo A C, Alvarez Zarikian C A, et al. 2011. Proceedingsof the Integrated Ocean Drilling Program, 323. Tokyo: Integrated Ocean Drilling Program Management International, Inc. doi: 10.2204/ iodp.proc.323.104.2011 Teraishi A, Suto I, Onodera J, et al. 2013. Diatom, silicoflagellate and ebridian biostratigraphyand paleoceanography in IODP 323 Hole U1343E at the Bering slope site. Deep-Sea Res Part II-Top Stud Oceanogr, doi: 10.1016/j.dsr2.2013.03.026 Underwood M B, Hathon E G. 1989. Provenance and dispersal of muds south of the Aleutian arc, north Pacific Ocean. Geo-Mar Lett, 9: 6775 VanLaningham S, Pisias N G, Duncan R A, et al. 2009. Glacial-interglacial sediment transport to the Meiji Drift, northwest Pacific Ocean: Evidence for timing of Beringian outwashing. Earth Planet Sci Lett, 277: 6472 Wan S M, Li A C, Clift P D, et al. 2006. Development of the East Asian summer monsoon: Evidence from the sediment record in the South China Sea since 8.5 Ma. Paleogeogr Paleoclimatol Paleoecol, 241: 139159Wan S M, Li A C, Clift P D, et al. 2007. Development of the East Asian monsoon: Mineralogical and sedimentologic records in the northern South China Sea since 20 Ma. Paleogeogr Paleoclimatol Paleoecol, 254: 561582 Wan S M, Li A C, Xu K F, et al. 2008. Characteristics of Clay Minerals in the Northern South China Sea and Its Implications for Evolution of East Asian Monsoon since Miocene (in Chinese). Earth Sci J China Univ Geosci, 33: 289300 Wan S M, Tian J, Steinke S. et al., 2010. Evolution and variability of the East Asian summer monsoon during the Pliocene: Evidence from clay mineral records of the South China Sea. Paleogeogr Paleoclimatol Paleoecol, 293: 237247 Wang P X, Tian J, Cheng X R, et al. 2003. Carbon reservoir changes preceded major ice-sheet expansion at the mid-Brunhes event. Geology, 31: 239242 Zhang Q, Chen M H, Zhang L L, et al., 2014a. Variations in the radiolarian assemblages in the Bering Sea since Pliocene and their implications for paleoceanography. Paleogeogr Paleoclimatol Paleoecol, 410: 337350 Zhang Q, Chen M H, Zhang L L, et al. 2014b. Radiolarian Biostratigraphy in the Southern Bering Sea since Pliocene. Sci China Earth Sci, 57: 682692"

	val doc = proc.annotate(text)

	val regex = " (ma|myr|mya|Ma|Myr|Mya|m\\.y\\.r) ".r

	for (sentence <- doc.sentences){

		// val temporal = parser.intervals(parser.parse(timex_batch), Some(anchor))

		val sent = sentence.words.mkString(" ")
		
		val newSent = regex.replaceAllIn(sent, "million years ago")

		println(newSent)

		for (timex <- parser.parse(sent, anchor)) timex match {
			case interval: Interval =>
	    		val Some((charStart, charEnd)) = interval.charSpan
	     		println(s"${interval.start} ${interval.end} ${sent.substring(charStart, charEnd)}")	

	     	case _ => println("unknown periods")
			
	    }

	}	
}